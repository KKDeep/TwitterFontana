<!DOCTYPE html>
<html>
<head>
    <title>TwitterFontana</title>
</head>
<body>
<h1>TwitterFontana</h1>
<p id="auth"></p>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script>
$(function () {
    var signin = '<a href="/api/twitter/session/new/" id="signin">Sign in with Twitter</a>',
        $auth = $('#auth');
    $.get('/api/twitter/session/').success(function (data) {
        $auth.html('Hello ' + data['screen_name'] + ', <a href="/api/twitter/session/clear/" id="signout">Sign out</a>');
        get_tweets();
    }).error(function () {
        $auth.html(signin);
    });

    $auth.on('click', '#signin', function (e) {
        e.preventDefault();
        var x = screen.width / 2 - 700 / 2,
            y = screen.height / 2 - 450 / 2,
            pop = null;
        pop = window.open($(this).attr('href'), new Date(), 'height=450,width=700,left='+x+',top='+y);
        pop.focus();
        return false;
    });

    $auth.on('click', '#signout', function (e) {
        e.preventDefault();
        $.post($(this).attr('href')).success(function () {
            $auth.html(signin);
        });
        return false;
    });

    function get_tweets() {
        $.get('/api/twitter/search?q=test').success(function (data) {
            console.log(data);
        });
    }
});
</script>
</body>
</html>